<!doctype html>
<html lang="en">
    <head>
        <title>Silly Bytes</title>

        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="shortcut icon" type="image/png" href="../../img/favicon.png" />

        <link rel="stylesheet" href="../../css/default.css" />
        <link rel="stylesheet" href="../../css/post-list.css" />
        <link rel="stylesheet" href="../../css/post.css" />

        <link rel="stylesheet" href="../../bower_components/bootstrap/dist/css/bootstrap.min.css" />
        <link rel="stylesheet" href="../../bower_components/highlight/src/styles/solarized-light.css" />

        <script src="../../bower_components/jquery/dist/jquery.min.js"></script>
        <script src="../../bower_components/bootstrap/dist/js/bootstrap.min.js"></script>
        <script src="../../bower_components/highlight/src/highlight.pack.js"></script>

        <script> hljs.initHighlightingOnLoad(); </script>

    </head>
    <body>
        <header class="container-fluid">
            <div class="row">
                <div class="col-xs-12">
                    <a href="../../">
                        <img alt="Silly Bytes" id="logo" class="image-responsive" src="../../img/silly-bytes_logo.png" />
                    </a>
                </div>
            </div>
        </header>

        <div id="blog" class="container-fluid">
            <div class="row">

                <div id="sidebar" class="hidden-xs hidden-sm col-md-3">
                    <div id="author">
    <img id="author-pic" src="../../img/daniel.jpg">
    <h3 id="author-name">Daniel Campoverde [alx741]</h3>
    <img id="location-icon" src="../../img/location_icon.png">
    <span id="location">Cuenca, Ecuador</span>
</div>

<div id="findme">
    <h2 class="sidebar-h2">FIND ME</h2>
    <a target="_blank" href="https://github.com/alx741">
        <img class="icon" src="../../img/github.png">
    </a>
    <a target="_blank" href="https://twitter.com/alx741alx">
        <img class="icon" src="../../img/twitter.png">
    </a>
    <a target="_blank" href="https://www.facebook.com/sillybytes/">
        <img class="icon" src="../../img/facebook.png">
    </a>
    <a target="_blank" href="https://plus.google.com/116038619580828681039">
        <img class="icon" src="../../img/google.png">
    </a>
    <a target="_blank" href="https://www.joindiaspora.com/u/alx741">
        <img class="icon" src="../../img/diaspora.png">
    </a>

    <div id="findme-textual">
        <b>Freenode:</b> #vim, #archlinux, #avr, #rust, #haskell,
        #yesod, #zsh, #sillybytes
        <hr>
        <b>Mailto:</b> alx@sillybytes.net
        <br>
        <b>GPG Key ID:</b> <a href="http://pgp.mit.edu/pks/lookup?op=get&search=0xEB0E776276450F22">76450F22</a>
        <hr>
        <b>Subscribe:</b> <a href="http://www.sillybytes.net/atom.xml">
            <img id="rss-img" alt="rss" src="../../img/rss.png" /> </a>
    </div>


    <div id="facebook-embed">
        <iframe src="//www.facebook.com/plugins/likebox.php?href=https%3A%2F%2Fwww.facebook.com%2Fsillybytes&amp;width&amp;height=290&amp;colorscheme=light&amp;show_faces=true&amp;header=true&amp;stream=false&amp;show_border=true" scrolling="yes" style="border:none; overflow:hidden;" allowtransparency="false" frameborder="0"></iframe>
    </div>
</div>

<div id="random">
    <h2 class="sidebar-h2">YOU MIGHT LIKE</h2>

    <div id="random-posts">
        <ul>
        </ul>
    </div>
</div>

<div id="about">
    <h2 class="sidebar-h2">ABOUT</h2>

    <a target="_blank" href="http://www.haskellers.com/user/4249">
        <img id="haskellers-img" class="badge" alt="I'm a Haskeller" src="../../img/haskellers.png">
    </a>

    <img id="fsf-img" class="badge" alt="Free Software Fundation Member" src="../../img/fsf.png">

    <a target="_blank" href="http://internetdefenseleague.org/">
        <img id="idl-img" class="badge" alt="Internet Defesen League" src="../../img/idl.png">
    </a>
</div>

<div id="dotfiles">
    <h2 class="sidebar-h2">DOTFILES</h2>
    <p>
        Software configuration, scripts, tools and magic.
        Be sure to add <b>attribution </b> when using them
        (fully or partially).
    </p>
    <a target="_blank" href="https://github.com/alx741/dotfiles#readme">
        <img id="dotfiles-img" src="../../img/dotfiles.png">
    </a>
</div>


<div id="license">
    <h2 class="sidebar-h2">LICENSE</h2>

    <a target="_blank" href="http://creativecommons.org/licenses/by-sa/3.0/deed.en_US">
        <img id="cc-img" alt="Creative Commons - SA - BY" src="../../img/cc.png">
    </a>
    <p id="cc-text">
        Silly Bytes by Daniel Alejandro Campoverde Carrión
        [alx741] is licensed under a
        <a href="http://creativecommons.org/licenses/by-sa/3.0/deed.en_US">
            Creative Commons Attribution-ShareAlike 3.0 Unported License.
        </a>
    </p>
</div>

                </div>

                <div id="content" class="col-xs-12 col-md-9">
                    <div class="row">
    <div class="post col-xs-12">
        <h2 class="post-title">Moviendo un motor paso a paso con el puerto paralelo sin integrados (Jugando con hardware)</h2>
        <div class="post-date-author">
            Posted on September 30, 2012
            
                by Daniel Campoverde
            
        </div>
        <div class="post-content">
            <p><img src="../../img/stepper/thumbnail.png" id="thumbnail" /><br />
</p>
<p>Esta vez vamos a jugar un poco con hardware, específicamente lo que haremos será mover un motor <em>PAP</em> (paso a paso) a través de la PC haciendo uso únicamente de transistores y sin usar ningún circuito integrado.</p>
<p>Para empezar es conveniente documentarse un poco del funcionamiento de este tipo de motores: http://es.wikipedia.org/wiki/Motor_paso_a_paso</p>
<p>Sabemos que para hacer girar un motor PAP Bipolar tenemos que dar pulsos secuenciales en sus 4 cables (Que llamaremos A, B, C y D), pero alternando la polaridad, por lo que la circuito necesario se complica un poco, mientras que para los Unipolares este problema desaparece, así que empezaremos por jugar con los motores PAP Unipolares.</p>
<!--more-->
<h1 id="unipolares">Unipolares</h1>
<p>Esquema de conexión en el puerto paralelo:</p>
<p><img src="../../img/stepper/scheme1.png" class="img-responsive" /></p>
<p>Me parece que es bastante evidente, pero vale aclarar que los pines del esquema son los correspondientes del puerto paralelo, y que estamos usando el nibble bajo del byte del puerto; además se puede ver como los 2 cables <em>comunes</em> del motor unipolar se conectan al positivo de la fuente de alimentación, la cual corresponde con la tensión que requiere nuestro motor (en mi caso 9V), y los cables A,B,C y D serán conectados al negativo de la fuente al saturarse los transistores con la señal del puerto.</p>
<p>Aquí se puede apreciar de color Rojo los 8 pines de datos del puerto, de los cuales hemos usado 4 (del pin 2 al 5) es decir 4 bits.</p>
<p><img src="../../img/stepper/scheme2.jpg" class="img-responsive" /></p>
<p>Aquí se pude observar el circuito que yo he montado y he usado un cable de puerto paralelo de una vieja impresora.</p>
<p><img src="../../img/stepper/shot1.jpg" class="img-responsive" /> <img src="../../img/stepper/shot2.jpg" class="img-responsive" /> <img src="../../img/stepper/shot3.jpg" class="img-responsive" /></p>
<h2 id="código">Código</h2>
<p>Con el circuito montado lo que necesitamos ahora es el código que saque las señales correctas en el orden correcto por el puerto paralelo para mover nuestro motor, y tomando en cuenta también los distintos modos a los que puede trabajar el motor (Simple Step, Double Step, Half Step).</p>
<h3 id="secuencias">Secuencias</h3>
<ul>
<li>Simple Step: <code>A-B-C-D</code></li>
<li>Double Step: <code>AB-BC-CD-DA</code></li>
<li>Half Step: <code>A-AB-B-BC-C-CD-D-DA</code></li>
</ul>
<p>El código no pretende ser un ejemplo de elegancia ni mucho menos, pero funciona. Es solamente una clase la cual usaremos con otro código para controlar el motor.</p>
<p><a href="https://github.com/alx741/pp_steppers/blob/master/unipolar.cpp">Código en Github</a></p>
<div class="sourceCode" id="cb1"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="co">/*</span></a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="co"> * =====================================================================================</span></a>
<a class="sourceLine" id="cb1-3" data-line-number="3"><span class="co"> *</span></a>
<a class="sourceLine" id="cb1-4" data-line-number="4"><span class="co"> *       Filename:  unipolar.cpp</span></a>
<a class="sourceLine" id="cb1-5" data-line-number="5"><span class="co"> *</span></a>
<a class="sourceLine" id="cb1-6" data-line-number="6"><span class="co"> *    Description: Clase para mover un motor PAP Unipolar por puerto paralelo</span></a>
<a class="sourceLine" id="cb1-7" data-line-number="7"><span class="co"> *</span></a>
<a class="sourceLine" id="cb1-8" data-line-number="8"><span class="co"> *        Version:  1.0</span></a>
<a class="sourceLine" id="cb1-9" data-line-number="9"><span class="co"> *        Created:  09/28/12 11:44:21</span></a>
<a class="sourceLine" id="cb1-10" data-line-number="10"><span class="co"> *       Revision:  none</span></a>
<a class="sourceLine" id="cb1-11" data-line-number="11"><span class="co"> *       Compiler:  g++</span></a>
<a class="sourceLine" id="cb1-12" data-line-number="12"><span class="co"> *       License:   GPLv3</span></a>
<a class="sourceLine" id="cb1-13" data-line-number="13"><span class="co"> *</span></a>
<a class="sourceLine" id="cb1-14" data-line-number="14"><span class="co"> *         Author: Daniel Campoverde Carrión</span></a>
<a class="sourceLine" id="cb1-15" data-line-number="15"><span class="co"> *   Organization: Silly Bytes</span></a>
<a class="sourceLine" id="cb1-16" data-line-number="16"><span class="co"> *</span></a>
<a class="sourceLine" id="cb1-17" data-line-number="17"><span class="co"> * =====================================================================================</span></a>
<a class="sourceLine" id="cb1-18" data-line-number="18"><span class="co"> */</span></a>
<a class="sourceLine" id="cb1-19" data-line-number="19"></a>
<a class="sourceLine" id="cb1-20" data-line-number="20"><span class="pp">#include </span><span class="im">&lt;iostream&gt;</span></a>
<a class="sourceLine" id="cb1-21" data-line-number="21"><span class="pp">#include </span><span class="im">&lt;sys/io.h&gt;</span></a>
<a class="sourceLine" id="cb1-22" data-line-number="22"><span class="pp">#include </span><span class="im">&lt;unistd.h&gt;</span></a>
<a class="sourceLine" id="cb1-23" data-line-number="23"></a>
<a class="sourceLine" id="cb1-24" data-line-number="24"><span class="pp">#define puerto (0x378) </span><span class="co">//Puede ser (0x278)</span></a>
<a class="sourceLine" id="cb1-25" data-line-number="25"></a>
<a class="sourceLine" id="cb1-26" data-line-number="26"><span class="co">//datos sacados por el nibble bajo del puerto paralelo</span></a>
<a class="sourceLine" id="cb1-27" data-line-number="27"><span class="co">//A,B,C,D son los cables del motor PAP</span></a>
<a class="sourceLine" id="cb1-28" data-line-number="28"><span class="pp">#define A 1</span></a>
<a class="sourceLine" id="cb1-29" data-line-number="29"><span class="pp">#define B 2</span></a>
<a class="sourceLine" id="cb1-30" data-line-number="30"><span class="pp">#define C 4</span></a>
<a class="sourceLine" id="cb1-31" data-line-number="31"><span class="pp">#define D 8</span></a>
<a class="sourceLine" id="cb1-32" data-line-number="32"><span class="pp">#define AB 3</span></a>
<a class="sourceLine" id="cb1-33" data-line-number="33"><span class="pp">#define BC 6</span></a>
<a class="sourceLine" id="cb1-34" data-line-number="34"><span class="pp">#define CD 12</span></a>
<a class="sourceLine" id="cb1-35" data-line-number="35"><span class="pp">#define DA 9</span></a>
<a class="sourceLine" id="cb1-36" data-line-number="36"></a>
<a class="sourceLine" id="cb1-37" data-line-number="37"></a>
<a class="sourceLine" id="cb1-38" data-line-number="38"></a>
<a class="sourceLine" id="cb1-39" data-line-number="39">using namespace std;</a>
<a class="sourceLine" id="cb1-40" data-line-number="40"></a>
<a class="sourceLine" id="cb1-41" data-line-number="41">class motor_unipolar{</a>
<a class="sourceLine" id="cb1-42" data-line-number="42"></a>
<a class="sourceLine" id="cb1-43" data-line-number="43">    public:</a>
<a class="sourceLine" id="cb1-44" data-line-number="44"></a>
<a class="sourceLine" id="cb1-45" data-line-number="45"></a>
<a class="sourceLine" id="cb1-46" data-line-number="46">    <span class="co">//steps=Numero de pasos del motor,type_step[0=simple,1=double.2=half]</span></a>
<a class="sourceLine" id="cb1-47" data-line-number="47"></a>
<a class="sourceLine" id="cb1-48" data-line-number="48">    motor_unipolar( <span class="dt">int</span> steps,  <span class="dt">int</span> type_step=<span class="dv">1</span>);</a>
<a class="sourceLine" id="cb1-49" data-line-number="49"></a>
<a class="sourceLine" id="cb1-50" data-line-number="50"></a>
<a class="sourceLine" id="cb1-51" data-line-number="51">    <span class="dt">int</span> step( <span class="dt">int</span> steps = <span class="dv">1</span>,  <span class="dt">int</span> direction = <span class="dv">0</span>,  <span class="dt">int</span> rate_step = <span class="dv">25000</span>); <span class="co">///pasos a dar,direccion[0=horario,1=antihorario],tiempo entre paso y paso(microsegundos)</span></a>
<a class="sourceLine" id="cb1-52" data-line-number="52"></a>
<a class="sourceLine" id="cb1-53" data-line-number="53">    <span class="dt">int</span> rotate( <span class="dt">int</span> angle = <span class="dv">1</span>, <span class="dt">int</span> direction = <span class="dv">0</span>,  <span class="dt">int</span> rate_step = <span class="dv">25000</span>);<span class="co">///angulo a rotar (degrees),direccion[0=horario,1=antihorario],tiempo entre paso y paso(microsegundos)</span></a>
<a class="sourceLine" id="cb1-54" data-line-number="54"></a>
<a class="sourceLine" id="cb1-55" data-line-number="55"></a>
<a class="sourceLine" id="cb1-56" data-line-number="56">    <span class="dt">void</span> stop(){ outb(puerto,<span class="dv">0</span>);} <span class="co">//poner a 0 el puerto</span></a>
<a class="sourceLine" id="cb1-57" data-line-number="57"></a>
<a class="sourceLine" id="cb1-58" data-line-number="58"></a>
<a class="sourceLine" id="cb1-59" data-line-number="59">    private:</a>
<a class="sourceLine" id="cb1-60" data-line-number="60"></a>
<a class="sourceLine" id="cb1-61" data-line-number="61">     <span class="dt">int</span> motor_steps;</a>
<a class="sourceLine" id="cb1-62" data-line-number="62">     <span class="dt">int</span> step_type;</a>
<a class="sourceLine" id="cb1-63" data-line-number="63">    <span class="dt">float</span> angle_by_step;</a>
<a class="sourceLine" id="cb1-64" data-line-number="64">    <span class="dt">int</span> sequence[<span class="dv">8</span>];</a>
<a class="sourceLine" id="cb1-65" data-line-number="65">    <span class="dt">int</span> *current_step;</a>
<a class="sourceLine" id="cb1-66" data-line-number="66">    <span class="dt">void</span> single_step( <span class="dt">int</span> direction);</a>
<a class="sourceLine" id="cb1-67" data-line-number="67">    <span class="dt">int</span> forward_sequence();</a>
<a class="sourceLine" id="cb1-68" data-line-number="68">    <span class="dt">void</span> backward_sequence();</a>
<a class="sourceLine" id="cb1-69" data-line-number="69"></a>
<a class="sourceLine" id="cb1-70" data-line-number="70">};</a>
<a class="sourceLine" id="cb1-71" data-line-number="71"></a>
<a class="sourceLine" id="cb1-72" data-line-number="72"></a>
<a class="sourceLine" id="cb1-73" data-line-number="73">motor_unipolar::motor_unipolar( <span class="dt">int</span> steps,  <span class="dt">int</span> type_step) : motor_steps(steps), step_type(type_step), angle_by_step(<span class="dv">360</span>/steps){</a>
<a class="sourceLine" id="cb1-74" data-line-number="74"></a>
<a class="sourceLine" id="cb1-75" data-line-number="75"></a>
<a class="sourceLine" id="cb1-76" data-line-number="76">    <span class="cf">if</span>(ioperm(puerto,<span class="dv">1</span>,<span class="dv">1</span>)){ <span class="co">//Abrir puerto y configurar permisos</span></a>
<a class="sourceLine" id="cb1-77" data-line-number="77">    cout &lt;&lt; <span class="st">&quot;Error de permisos&quot;</span> &lt;&lt; endl &lt;&lt; flush;</a>
<a class="sourceLine" id="cb1-78" data-line-number="78"></a>
<a class="sourceLine" id="cb1-79" data-line-number="79">    }</a>
<a class="sourceLine" id="cb1-80" data-line-number="80"></a>
<a class="sourceLine" id="cb1-81" data-line-number="81"></a>
<a class="sourceLine" id="cb1-82" data-line-number="82">    <span class="cf">switch</span>(step_type){</a>
<a class="sourceLine" id="cb1-83" data-line-number="83"></a>
<a class="sourceLine" id="cb1-84" data-line-number="84">    <span class="cf">case</span> <span class="dv">0</span>:</a>
<a class="sourceLine" id="cb1-85" data-line-number="85">        sequence[<span class="dv">0</span>] = A; <span class="co">//Secuencia simple_step</span></a>
<a class="sourceLine" id="cb1-86" data-line-number="86">        sequence[<span class="dv">1</span>] = B;</a>
<a class="sourceLine" id="cb1-87" data-line-number="87">        sequence[<span class="dv">2</span>] = C;</a>
<a class="sourceLine" id="cb1-88" data-line-number="88">        sequence[<span class="dv">3</span>] = D;</a>
<a class="sourceLine" id="cb1-89" data-line-number="89">        sequence[<span class="dv">4</span>] = <span class="dv">0</span>;</a>
<a class="sourceLine" id="cb1-90" data-line-number="90">        sequence[<span class="dv">5</span>] = <span class="dv">0</span>;</a>
<a class="sourceLine" id="cb1-91" data-line-number="91">        sequence[<span class="dv">6</span>] = <span class="dv">0</span>;</a>
<a class="sourceLine" id="cb1-92" data-line-number="92">        sequence[<span class="dv">7</span>] = <span class="dv">0</span>;</a>
<a class="sourceLine" id="cb1-93" data-line-number="93"></a>
<a class="sourceLine" id="cb1-94" data-line-number="94">        <span class="cf">break</span>;</a>
<a class="sourceLine" id="cb1-95" data-line-number="95">    <span class="cf">case</span> <span class="dv">1</span>:</a>
<a class="sourceLine" id="cb1-96" data-line-number="96">        sequence[<span class="dv">0</span>] = AB; <span class="co">//Secuencia double_step</span></a>
<a class="sourceLine" id="cb1-97" data-line-number="97">        sequence[<span class="dv">1</span>] = BC;</a>
<a class="sourceLine" id="cb1-98" data-line-number="98">        sequence[<span class="dv">2</span>] = CD;</a>
<a class="sourceLine" id="cb1-99" data-line-number="99">        sequence[<span class="dv">3</span>] = DA;</a>
<a class="sourceLine" id="cb1-100" data-line-number="100">        sequence[<span class="dv">4</span>] = <span class="dv">0</span>;</a>
<a class="sourceLine" id="cb1-101" data-line-number="101">        sequence[<span class="dv">5</span>] = <span class="dv">0</span>;</a>
<a class="sourceLine" id="cb1-102" data-line-number="102">        sequence[<span class="dv">6</span>] = <span class="dv">0</span>;</a>
<a class="sourceLine" id="cb1-103" data-line-number="103">        sequence[<span class="dv">7</span>] = <span class="dv">0</span>;</a>
<a class="sourceLine" id="cb1-104" data-line-number="104"></a>
<a class="sourceLine" id="cb1-105" data-line-number="105"></a>
<a class="sourceLine" id="cb1-106" data-line-number="106"></a>
<a class="sourceLine" id="cb1-107" data-line-number="107">        <span class="cf">break</span>;</a>
<a class="sourceLine" id="cb1-108" data-line-number="108">    <span class="cf">case</span> <span class="dv">2</span>:</a>
<a class="sourceLine" id="cb1-109" data-line-number="109">        sequence[<span class="dv">0</span>] = A; <span class="co">//Secuencia half_step</span></a>
<a class="sourceLine" id="cb1-110" data-line-number="110">        sequence[<span class="dv">1</span>] = AB;</a>
<a class="sourceLine" id="cb1-111" data-line-number="111">        sequence[<span class="dv">2</span>] = B;</a>
<a class="sourceLine" id="cb1-112" data-line-number="112">        sequence[<span class="dv">3</span>] = BC;</a>
<a class="sourceLine" id="cb1-113" data-line-number="113">        sequence[<span class="dv">4</span>] = C;</a>
<a class="sourceLine" id="cb1-114" data-line-number="114">        sequence[<span class="dv">5</span>] = CD;</a>
<a class="sourceLine" id="cb1-115" data-line-number="115">        sequence[<span class="dv">6</span>] = D;</a>
<a class="sourceLine" id="cb1-116" data-line-number="116">        sequence[<span class="dv">7</span>] = DA;</a>
<a class="sourceLine" id="cb1-117" data-line-number="117"></a>
<a class="sourceLine" id="cb1-118" data-line-number="118">        <span class="cf">break</span>;</a>
<a class="sourceLine" id="cb1-119" data-line-number="119"></a>
<a class="sourceLine" id="cb1-120" data-line-number="120">    }</a>
<a class="sourceLine" id="cb1-121" data-line-number="121"></a>
<a class="sourceLine" id="cb1-122" data-line-number="122"></a>
<a class="sourceLine" id="cb1-123" data-line-number="123"></a>
<a class="sourceLine" id="cb1-124" data-line-number="124"></a>
<a class="sourceLine" id="cb1-125" data-line-number="125">    current_step = sequence;<span class="co">//colocamos el paso actual al principio de ka secuencia</span></a>
<a class="sourceLine" id="cb1-126" data-line-number="126"></a>
<a class="sourceLine" id="cb1-127" data-line-number="127"></a>
<a class="sourceLine" id="cb1-128" data-line-number="128"></a>
<a class="sourceLine" id="cb1-129" data-line-number="129"></a>
<a class="sourceLine" id="cb1-130" data-line-number="130">}</a>
<a class="sourceLine" id="cb1-131" data-line-number="131"></a>
<a class="sourceLine" id="cb1-132" data-line-number="132"></a>
<a class="sourceLine" id="cb1-133" data-line-number="133"></a>
<a class="sourceLine" id="cb1-134" data-line-number="134"><span class="dt">int</span> motor_unipolar::step( <span class="dt">int</span> steps,  <span class="dt">int</span>  direction,  <span class="dt">int</span> rate_step){</a>
<a class="sourceLine" id="cb1-135" data-line-number="135"></a>
<a class="sourceLine" id="cb1-136" data-line-number="136"></a>
<a class="sourceLine" id="cb1-137" data-line-number="137"></a>
<a class="sourceLine" id="cb1-138" data-line-number="138"></a>
<a class="sourceLine" id="cb1-139" data-line-number="139">    <span class="cf">while</span>(steps &gt; <span class="dv">0</span>){</a>
<a class="sourceLine" id="cb1-140" data-line-number="140"></a>
<a class="sourceLine" id="cb1-141" data-line-number="141">    single_step(direction);</a>
<a class="sourceLine" id="cb1-142" data-line-number="142">    usleep(rate_step);</a>
<a class="sourceLine" id="cb1-143" data-line-number="143">    steps--;</a>
<a class="sourceLine" id="cb1-144" data-line-number="144"></a>
<a class="sourceLine" id="cb1-145" data-line-number="145">    cout &lt;&lt; *current_step &lt;&lt; endl &lt;&lt; flush;</a>
<a class="sourceLine" id="cb1-146" data-line-number="146">    }</a>
<a class="sourceLine" id="cb1-147" data-line-number="147"></a>
<a class="sourceLine" id="cb1-148" data-line-number="148">    <span class="cf">return</span> <span class="dv">0</span>;</a>
<a class="sourceLine" id="cb1-149" data-line-number="149">}</a>
<a class="sourceLine" id="cb1-150" data-line-number="150"></a>
<a class="sourceLine" id="cb1-151" data-line-number="151"></a>
<a class="sourceLine" id="cb1-152" data-line-number="152"><span class="dt">int</span> motor_unipolar::rotate( <span class="dt">int</span> angle, <span class="dt">int</span> direction,  <span class="dt">int</span> rate_step){</a>
<a class="sourceLine" id="cb1-153" data-line-number="153"></a>
<a class="sourceLine" id="cb1-154" data-line-number="154"></a>
<a class="sourceLine" id="cb1-155" data-line-number="155"></a>
<a class="sourceLine" id="cb1-156" data-line-number="156">     <span class="dt">int</span> steps =  <span class="dt">int</span>(angle/angle_by_step);</a>
<a class="sourceLine" id="cb1-157" data-line-number="157"></a>
<a class="sourceLine" id="cb1-158" data-line-number="158"></a>
<a class="sourceLine" id="cb1-159" data-line-number="159">    <span class="cf">while</span>(steps &gt; <span class="dv">0</span>){</a>
<a class="sourceLine" id="cb1-160" data-line-number="160"></a>
<a class="sourceLine" id="cb1-161" data-line-number="161">    single_step(direction);</a>
<a class="sourceLine" id="cb1-162" data-line-number="162">    usleep(rate_step);</a>
<a class="sourceLine" id="cb1-163" data-line-number="163">    steps--;</a>
<a class="sourceLine" id="cb1-164" data-line-number="164"></a>
<a class="sourceLine" id="cb1-165" data-line-number="165">    }</a>
<a class="sourceLine" id="cb1-166" data-line-number="166"></a>
<a class="sourceLine" id="cb1-167" data-line-number="167">    <span class="cf">return</span> <span class="dv">0</span>;</a>
<a class="sourceLine" id="cb1-168" data-line-number="168">}</a>
<a class="sourceLine" id="cb1-169" data-line-number="169"></a>
<a class="sourceLine" id="cb1-170" data-line-number="170"></a>
<a class="sourceLine" id="cb1-171" data-line-number="171"><span class="dt">int</span> motor_unipolar::forward_sequence(){</a>
<a class="sourceLine" id="cb1-172" data-line-number="172"></a>
<a class="sourceLine" id="cb1-173" data-line-number="173">    <span class="cf">if</span>(current_step==&amp;sequence[<span class="dv">7</span>] || *current_step == <span class="dv">0</span>){ current_step = sequence; <span class="cf">return</span> <span class="dv">0</span>;} <span class="co">//reiniciamos la secuencia</span></a>
<a class="sourceLine" id="cb1-174" data-line-number="174"></a>
<a class="sourceLine" id="cb1-175" data-line-number="175">    current_step++; <span class="co">//avanzamos en la secuencia</span></a>
<a class="sourceLine" id="cb1-176" data-line-number="176"></a>
<a class="sourceLine" id="cb1-177" data-line-number="177">    <span class="cf">if</span>(*current_step == <span class="dv">0</span>){ current_step = sequence; <span class="cf">return</span> <span class="dv">0</span>;}</a>
<a class="sourceLine" id="cb1-178" data-line-number="178">    <span class="cf">return</span> <span class="dv">0</span>;</a>
<a class="sourceLine" id="cb1-179" data-line-number="179"></a>
<a class="sourceLine" id="cb1-180" data-line-number="180">}</a>
<a class="sourceLine" id="cb1-181" data-line-number="181"></a>
<a class="sourceLine" id="cb1-182" data-line-number="182"><span class="dt">void</span> motor_unipolar::backward_sequence(){</a>
<a class="sourceLine" id="cb1-183" data-line-number="183"></a>
<a class="sourceLine" id="cb1-184" data-line-number="184">    <span class="cf">if</span>(current_step==&amp;sequence[<span class="dv">0</span>]) current_step = &amp;sequence[<span class="dv">7</span>]; <span class="co">//reiniciamos la secuencia</span></a>
<a class="sourceLine" id="cb1-185" data-line-number="185"></a>
<a class="sourceLine" id="cb1-186" data-line-number="186"></a>
<a class="sourceLine" id="cb1-187" data-line-number="187">    current_step--; <span class="co">//avanzamos en la secuencia</span></a>
<a class="sourceLine" id="cb1-188" data-line-number="188"></a>
<a class="sourceLine" id="cb1-189" data-line-number="189">    <span class="cf">if</span>(*current_step==<span class="dv">0</span>) backward_sequence();</a>
<a class="sourceLine" id="cb1-190" data-line-number="190"></a>
<a class="sourceLine" id="cb1-191" data-line-number="191">}</a>
<a class="sourceLine" id="cb1-192" data-line-number="192"></a>
<a class="sourceLine" id="cb1-193" data-line-number="193"><span class="dt">void</span> motor_unipolar::single_step( <span class="dt">int</span> direction){</a>
<a class="sourceLine" id="cb1-194" data-line-number="194"></a>
<a class="sourceLine" id="cb1-195" data-line-number="195">outb(*current_step,puerto);</a>
<a class="sourceLine" id="cb1-196" data-line-number="196"></a>
<a class="sourceLine" id="cb1-197" data-line-number="197"><span class="cf">if</span>(direction==<span class="dv">0</span>){ forward_sequence();}</a>
<a class="sourceLine" id="cb1-198" data-line-number="198"><span class="cf">else</span>{backward_sequence();}</a>
<a class="sourceLine" id="cb1-199" data-line-number="199"></a>
<a class="sourceLine" id="cb1-200" data-line-number="200">}</a>
<a class="sourceLine" id="cb1-201" data-line-number="201"></a>
<a class="sourceLine" id="cb1-202" data-line-number="202"></a>
<a class="sourceLine" id="cb1-203" data-line-number="203"></a>
<a class="sourceLine" id="cb1-204" data-line-number="204"><span class="dt">int</span> main(){</a>
<a class="sourceLine" id="cb1-205" data-line-number="205"></a>
<a class="sourceLine" id="cb1-206" data-line-number="206">    <span class="dt">int</span> opcion;</a>
<a class="sourceLine" id="cb1-207" data-line-number="207">    motor_unipolar motor(<span class="dv">200</span>);</a>
<a class="sourceLine" id="cb1-208" data-line-number="208">    <span class="dt">int</span> direccion;</a>
<a class="sourceLine" id="cb1-209" data-line-number="209">    <span class="dt">int</span> valor;</a>
<a class="sourceLine" id="cb1-210" data-line-number="210"></a>
<a class="sourceLine" id="cb1-211" data-line-number="211"></a>
<a class="sourceLine" id="cb1-212" data-line-number="212">    <span class="cf">for</span>(;;){</a>
<a class="sourceLine" id="cb1-213" data-line-number="213"></a>
<a class="sourceLine" id="cb1-214" data-line-number="214">    cout &lt;&lt; <span class="st">&quot;</span><span class="sc">\n\n\n</span><span class="st">Angulo, Pasos, Salir[0,1,2]</span><span class="sc">\n</span><span class="st"> &gt;&gt;  &quot;</span>;</a>
<a class="sourceLine" id="cb1-215" data-line-number="215">    cin &gt;&gt; opcion;</a>
<a class="sourceLine" id="cb1-216" data-line-number="216">    cout &lt;&lt; <span class="st">&quot;Valor (angulo o pasos)</span><span class="sc">\n</span><span class="st"> &gt;&gt;  &quot;</span>;</a>
<a class="sourceLine" id="cb1-217" data-line-number="217">    cin &gt;&gt; valor;</a>
<a class="sourceLine" id="cb1-218" data-line-number="218">    cout &lt;&lt; <span class="st">&quot;Direccion[0,1]</span><span class="sc">\n</span><span class="st"> &gt;&gt; &quot;</span>;</a>
<a class="sourceLine" id="cb1-219" data-line-number="219">    cin &gt;&gt; direccion;</a>
<a class="sourceLine" id="cb1-220" data-line-number="220"></a>
<a class="sourceLine" id="cb1-221" data-line-number="221">    <span class="cf">if</span>(opcion==<span class="dv">0</span>){</a>
<a class="sourceLine" id="cb1-222" data-line-number="222"></a>
<a class="sourceLine" id="cb1-223" data-line-number="223">        cout &lt;&lt; <span class="st">&quot;Rotando...&quot;</span> &lt;&lt; endl;</a>
<a class="sourceLine" id="cb1-224" data-line-number="224">        motor.rotate(valor,direccion);</a>
<a class="sourceLine" id="cb1-225" data-line-number="225"></a>
<a class="sourceLine" id="cb1-226" data-line-number="226">    }<span class="cf">else</span> <span class="cf">if</span>(opcion==<span class="dv">1</span>){</a>
<a class="sourceLine" id="cb1-227" data-line-number="227"></a>
<a class="sourceLine" id="cb1-228" data-line-number="228">        motor.step(valor,direccion);</a>
<a class="sourceLine" id="cb1-229" data-line-number="229">        cout &lt;&lt; <span class="st">&quot;Rotando...&quot;</span> &lt;&lt; endl;</a>
<a class="sourceLine" id="cb1-230" data-line-number="230"></a>
<a class="sourceLine" id="cb1-231" data-line-number="231">    }<span class="cf">else</span>{ motor.stop(); <span class="cf">return</span> <span class="dv">0</span>;}</a>
<a class="sourceLine" id="cb1-232" data-line-number="232"></a>
<a class="sourceLine" id="cb1-233" data-line-number="233">    }</a>
<a class="sourceLine" id="cb1-234" data-line-number="234">}</a></code></pre></div>
<h1 id="bipolares">Bipolares</h1>
<p>Esquema de conexión en el puerto paralelo:</p>
<p><img src="../../img/stepper/scheme3.png" class="img-responsive" /></p>
<p>Aquí he implementado 2 <em>puentes H</em> de transistores para controlar ambas bobinas del motor alternando las polaridades usando nuevamente 4 pines de los 8 del puerto</p>
<h2 id="código-1">Código</h2>
<p>En este caso el código es más simple puesto que en los motores PAP Bipolares no tenemos distintos modos de paso.</p>
<p><a href="https://github.com/alx741/pp_steppers/blob/master/bipolar.cpp">Código en Github</a></p>
<div class="sourceCode" id="cb2"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="co">/*</span></a>
<a class="sourceLine" id="cb2-2" data-line-number="2"><span class="co"> * =====================================================================================</span></a>
<a class="sourceLine" id="cb2-3" data-line-number="3"><span class="co"> *</span></a>
<a class="sourceLine" id="cb2-4" data-line-number="4"><span class="co"> *       Filename:  bipolar.cpp</span></a>
<a class="sourceLine" id="cb2-5" data-line-number="5"><span class="co"> *</span></a>
<a class="sourceLine" id="cb2-6" data-line-number="6"><span class="co"> *    Description: Clase para mover un motor PAP Bipolar por puerto paralelo</span></a>
<a class="sourceLine" id="cb2-7" data-line-number="7"><span class="co"> *</span></a>
<a class="sourceLine" id="cb2-8" data-line-number="8"><span class="co"> *        Version:  1.0</span></a>
<a class="sourceLine" id="cb2-9" data-line-number="9"><span class="co"> *        Created:  09/28/12 11:44:21</span></a>
<a class="sourceLine" id="cb2-10" data-line-number="10"><span class="co"> *       Revision:  none</span></a>
<a class="sourceLine" id="cb2-11" data-line-number="11"><span class="co"> *       Compiler:  g++</span></a>
<a class="sourceLine" id="cb2-12" data-line-number="12"><span class="co"> *       License:   GPLv3</span></a>
<a class="sourceLine" id="cb2-13" data-line-number="13"><span class="co"> *</span></a>
<a class="sourceLine" id="cb2-14" data-line-number="14"><span class="co"> *         Author:  Daniel Campoverde CarriÃn</span></a>
<a class="sourceLine" id="cb2-15" data-line-number="15"><span class="co"> *   Organization: Silly Bytes</span></a>
<a class="sourceLine" id="cb2-16" data-line-number="16"><span class="co"> *</span></a>
<a class="sourceLine" id="cb2-17" data-line-number="17"><span class="co"> * =====================================================================================</span></a>
<a class="sourceLine" id="cb2-18" data-line-number="18"><span class="co"> */</span></a>
<a class="sourceLine" id="cb2-19" data-line-number="19"></a>
<a class="sourceLine" id="cb2-20" data-line-number="20"><span class="pp">#include </span><span class="im">&lt;iostream&gt;</span></a>
<a class="sourceLine" id="cb2-21" data-line-number="21"><span class="pp">#include </span><span class="im">&lt;sys/io.h&gt;</span></a>
<a class="sourceLine" id="cb2-22" data-line-number="22"><span class="pp">#include </span><span class="im">&lt;unistd.h&gt;</span></a>
<a class="sourceLine" id="cb2-23" data-line-number="23"></a>
<a class="sourceLine" id="cb2-24" data-line-number="24"><span class="pp">#define puerto (0x378) </span><span class="co">//Puede ser (0x278)</span></a>
<a class="sourceLine" id="cb2-25" data-line-number="25"></a>
<a class="sourceLine" id="cb2-26" data-line-number="26"><span class="co">//datos sacados por el nibble bajo del puerto paralelo</span></a>
<a class="sourceLine" id="cb2-27" data-line-number="27"><span class="co">//A,B,C,D son los cables del motor PAP</span></a>
<a class="sourceLine" id="cb2-28" data-line-number="28"><span class="pp">#define A 1 </span><span class="co">//bobina 1 polaridad 1</span></a>
<a class="sourceLine" id="cb2-29" data-line-number="29"><span class="pp">#define B 2 </span><span class="co">//bobina 1 polaridad 2</span></a>
<a class="sourceLine" id="cb2-30" data-line-number="30"><span class="pp">#define C 4 </span><span class="co">//bobina 2 polaridad 1</span></a>
<a class="sourceLine" id="cb2-31" data-line-number="31"><span class="pp">#define D 8 </span><span class="co">//bobina 2 polaridad 2</span></a>
<a class="sourceLine" id="cb2-32" data-line-number="32"></a>
<a class="sourceLine" id="cb2-33" data-line-number="33"></a>
<a class="sourceLine" id="cb2-34" data-line-number="34">using namespace std;</a>
<a class="sourceLine" id="cb2-35" data-line-number="35"></a>
<a class="sourceLine" id="cb2-36" data-line-number="36">class motor_bipolar{</a>
<a class="sourceLine" id="cb2-37" data-line-number="37"></a>
<a class="sourceLine" id="cb2-38" data-line-number="38">    public:</a>
<a class="sourceLine" id="cb2-39" data-line-number="39"></a>
<a class="sourceLine" id="cb2-40" data-line-number="40"></a>
<a class="sourceLine" id="cb2-41" data-line-number="41">    <span class="co">//steps=Numero de pasos del motor</span></a>
<a class="sourceLine" id="cb2-42" data-line-number="42"></a>
<a class="sourceLine" id="cb2-43" data-line-number="43">    motor_bipolar( <span class="dt">int</span> steps);</a>
<a class="sourceLine" id="cb2-44" data-line-number="44"></a>
<a class="sourceLine" id="cb2-45" data-line-number="45"></a>
<a class="sourceLine" id="cb2-46" data-line-number="46">    <span class="dt">int</span> step( <span class="dt">int</span> steps = <span class="dv">1</span>,  <span class="dt">int</span> direction = <span class="dv">0</span>,  <span class="dt">int</span> rate_step = <span class="dv">25000</span>); <span class="co">///pasos a dar,direccion[0=horario,1=antihorario],tiempo entre paso y paso(microsegundos)</span></a>
<a class="sourceLine" id="cb2-47" data-line-number="47"></a>
<a class="sourceLine" id="cb2-48" data-line-number="48">    <span class="dt">int</span> rotate( <span class="dt">int</span> angle = <span class="dv">1</span>, <span class="dt">int</span> direction = <span class="dv">0</span>,  <span class="dt">int</span> rate_step = <span class="dv">25000</span>);<span class="co">///angulo a rotar (degrees),direccion[0=horario,1=antihorario],tiempo entre paso y paso(microsegundos)</span></a>
<a class="sourceLine" id="cb2-49" data-line-number="49"></a>
<a class="sourceLine" id="cb2-50" data-line-number="50">    private:</a>
<a class="sourceLine" id="cb2-51" data-line-number="51"></a>
<a class="sourceLine" id="cb2-52" data-line-number="52">     <span class="dt">int</span> motor_steps;</a>
<a class="sourceLine" id="cb2-53" data-line-number="53"></a>
<a class="sourceLine" id="cb2-54" data-line-number="54">    <span class="dt">float</span> angle_by_step;</a>
<a class="sourceLine" id="cb2-55" data-line-number="55">    <span class="dt">int</span> sequence[<span class="dv">4</span>] = {A,B,C,D};</a>
<a class="sourceLine" id="cb2-56" data-line-number="56">    <span class="dt">int</span> *current_step;</a>
<a class="sourceLine" id="cb2-57" data-line-number="57">    <span class="dt">void</span> single_step( <span class="dt">int</span> direction);</a>
<a class="sourceLine" id="cb2-58" data-line-number="58">    <span class="dt">int</span> forward_sequence();</a>
<a class="sourceLine" id="cb2-59" data-line-number="59">    <span class="dt">void</span> backward_sequence();</a>
<a class="sourceLine" id="cb2-60" data-line-number="60"></a>
<a class="sourceLine" id="cb2-61" data-line-number="61">};</a>
<a class="sourceLine" id="cb2-62" data-line-number="62"></a>
<a class="sourceLine" id="cb2-63" data-line-number="63"></a>
<a class="sourceLine" id="cb2-64" data-line-number="64">motor_bipolar::motor_bipolar( <span class="dt">int</span> steps) : motor_steps(steps), angle_by_step(<span class="dv">360</span>/steps), current_step(sequence){</a>
<a class="sourceLine" id="cb2-65" data-line-number="65"></a>
<a class="sourceLine" id="cb2-66" data-line-number="66"></a>
<a class="sourceLine" id="cb2-67" data-line-number="67">    <span class="cf">if</span>(ioperm(puerto,<span class="dv">1</span>,<span class="dv">1</span>)){ <span class="co">//Abrir puerto y configurar permisos</span></a>
<a class="sourceLine" id="cb2-68" data-line-number="68">    cout &lt;&lt; <span class="st">&quot;Error de permisos&quot;</span> &lt;&lt; endl &lt;&lt; flush;</a>
<a class="sourceLine" id="cb2-69" data-line-number="69"></a>
<a class="sourceLine" id="cb2-70" data-line-number="70">    }</a>
<a class="sourceLine" id="cb2-71" data-line-number="71"></a>
<a class="sourceLine" id="cb2-72" data-line-number="72"></a>
<a class="sourceLine" id="cb2-73" data-line-number="73">}</a>
<a class="sourceLine" id="cb2-74" data-line-number="74"></a>
<a class="sourceLine" id="cb2-75" data-line-number="75"></a>
<a class="sourceLine" id="cb2-76" data-line-number="76"></a>
<a class="sourceLine" id="cb2-77" data-line-number="77"><span class="dt">int</span> motor_bipolar::step( <span class="dt">int</span> steps,  <span class="dt">int</span>  direction,  <span class="dt">int</span> rate_step){</a>
<a class="sourceLine" id="cb2-78" data-line-number="78"></a>
<a class="sourceLine" id="cb2-79" data-line-number="79"></a>
<a class="sourceLine" id="cb2-80" data-line-number="80"></a>
<a class="sourceLine" id="cb2-81" data-line-number="81"></a>
<a class="sourceLine" id="cb2-82" data-line-number="82">    <span class="cf">while</span>(steps &gt; <span class="dv">0</span>){</a>
<a class="sourceLine" id="cb2-83" data-line-number="83"></a>
<a class="sourceLine" id="cb2-84" data-line-number="84">    single_step(direction);</a>
<a class="sourceLine" id="cb2-85" data-line-number="85">    usleep(rate_step);</a>
<a class="sourceLine" id="cb2-86" data-line-number="86">    steps--;</a>
<a class="sourceLine" id="cb2-87" data-line-number="87"></a>
<a class="sourceLine" id="cb2-88" data-line-number="88"></a>
<a class="sourceLine" id="cb2-89" data-line-number="89">    }</a>
<a class="sourceLine" id="cb2-90" data-line-number="90"></a>
<a class="sourceLine" id="cb2-91" data-line-number="91">    <span class="cf">return</span> <span class="dv">0</span>;</a>
<a class="sourceLine" id="cb2-92" data-line-number="92">}</a>
<a class="sourceLine" id="cb2-93" data-line-number="93"></a>
<a class="sourceLine" id="cb2-94" data-line-number="94"></a>
<a class="sourceLine" id="cb2-95" data-line-number="95"><span class="dt">int</span> motor_bipolar::rotate( <span class="dt">int</span> angle, <span class="dt">int</span> direction,  <span class="dt">int</span> rate_step){</a>
<a class="sourceLine" id="cb2-96" data-line-number="96"></a>
<a class="sourceLine" id="cb2-97" data-line-number="97"></a>
<a class="sourceLine" id="cb2-98" data-line-number="98"></a>
<a class="sourceLine" id="cb2-99" data-line-number="99">     <span class="dt">int</span> steps =  <span class="dt">int</span>(angle/angle_by_step);</a>
<a class="sourceLine" id="cb2-100" data-line-number="100"></a>
<a class="sourceLine" id="cb2-101" data-line-number="101"></a>
<a class="sourceLine" id="cb2-102" data-line-number="102">    <span class="cf">while</span>(steps &gt; <span class="dv">0</span>){</a>
<a class="sourceLine" id="cb2-103" data-line-number="103"></a>
<a class="sourceLine" id="cb2-104" data-line-number="104">    single_step(direction);</a>
<a class="sourceLine" id="cb2-105" data-line-number="105">    usleep(rate_step);</a>
<a class="sourceLine" id="cb2-106" data-line-number="106">    steps--;</a>
<a class="sourceLine" id="cb2-107" data-line-number="107"></a>
<a class="sourceLine" id="cb2-108" data-line-number="108">    }</a>
<a class="sourceLine" id="cb2-109" data-line-number="109"></a>
<a class="sourceLine" id="cb2-110" data-line-number="110">    <span class="cf">return</span> <span class="dv">0</span>;</a>
<a class="sourceLine" id="cb2-111" data-line-number="111">}</a>
<a class="sourceLine" id="cb2-112" data-line-number="112"></a>
<a class="sourceLine" id="cb2-113" data-line-number="113"></a>
<a class="sourceLine" id="cb2-114" data-line-number="114"><span class="dt">int</span> motor_bipolar::forward_sequence(){</a>
<a class="sourceLine" id="cb2-115" data-line-number="115"></a>
<a class="sourceLine" id="cb2-116" data-line-number="116">    <span class="cf">if</span>(current_step==&amp;sequence[<span class="dv">4</span>]){ current_step = sequence; <span class="cf">return</span> <span class="dv">0</span>;} <span class="co">//reiniciamos la secuencia</span></a>
<a class="sourceLine" id="cb2-117" data-line-number="117"></a>
<a class="sourceLine" id="cb2-118" data-line-number="118">    current_step++; <span class="co">//avanzamos en la secuencia</span></a>
<a class="sourceLine" id="cb2-119" data-line-number="119"></a>
<a class="sourceLine" id="cb2-120" data-line-number="120">    <span class="cf">return</span> <span class="dv">0</span>;</a>
<a class="sourceLine" id="cb2-121" data-line-number="121"></a>
<a class="sourceLine" id="cb2-122" data-line-number="122">}</a>
<a class="sourceLine" id="cb2-123" data-line-number="123"></a>
<a class="sourceLine" id="cb2-124" data-line-number="124"><span class="dt">void</span> motor_bipolar::backward_sequence(){</a>
<a class="sourceLine" id="cb2-125" data-line-number="125"></a>
<a class="sourceLine" id="cb2-126" data-line-number="126">    <span class="cf">if</span>(current_step==&amp;sequence[<span class="dv">0</span>]) current_step = &amp;sequence[<span class="dv">4</span>]; <span class="co">//reiniciamos la secuencia</span></a>
<a class="sourceLine" id="cb2-127" data-line-number="127"></a>
<a class="sourceLine" id="cb2-128" data-line-number="128"></a>
<a class="sourceLine" id="cb2-129" data-line-number="129">    current_step--; <span class="co">//avanzamos en la secuencia</span></a>
<a class="sourceLine" id="cb2-130" data-line-number="130"></a>
<a class="sourceLine" id="cb2-131" data-line-number="131"></a>
<a class="sourceLine" id="cb2-132" data-line-number="132">}</a>
<a class="sourceLine" id="cb2-133" data-line-number="133"></a>
<a class="sourceLine" id="cb2-134" data-line-number="134"><span class="dt">void</span> motor_bipolar::single_step( <span class="dt">int</span> direction){</a>
<a class="sourceLine" id="cb2-135" data-line-number="135"></a>
<a class="sourceLine" id="cb2-136" data-line-number="136">outb(*current_step,puerto);</a>
<a class="sourceLine" id="cb2-137" data-line-number="137"></a>
<a class="sourceLine" id="cb2-138" data-line-number="138"><span class="cf">if</span>(direction==<span class="dv">0</span>){ forward_sequence();}</a>
<a class="sourceLine" id="cb2-139" data-line-number="139"><span class="cf">else</span>{backward_sequence();}</a>
<a class="sourceLine" id="cb2-140" data-line-number="140"></a>
<a class="sourceLine" id="cb2-141" data-line-number="141">}</a></code></pre></div>
<h1 id="haciendo-girar-el-motor">Haciendo girar el motor</h1>
<p>Ahora que tenemos las clases necesarias para mover el motor cuyo circuito ya tenemos montado en el puerto paralelo, usaremos un código que a su vez aproveche dichas clases para jugar con el motor.</p>
<p>Así que ha manera de ejemplo yo he agregado la función <code>main()</code> para el fuente de <em>unipolar.cpp</em>, quedando así:</p>
<p><a href="https://github.com/alx741/pp_steppers/blob/master/rotate.cpp">Código en Github</a></p>
<div class="sourceCode" id="cb3"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="co">/*</span></a>
<a class="sourceLine" id="cb3-2" data-line-number="2"><span class="co"> * =====================================================================================</span></a>
<a class="sourceLine" id="cb3-3" data-line-number="3"><span class="co"> *</span></a>
<a class="sourceLine" id="cb3-4" data-line-number="4"><span class="co"> *       Filename:  rotate.cpp</span></a>
<a class="sourceLine" id="cb3-5" data-line-number="5"><span class="co"> *</span></a>
<a class="sourceLine" id="cb3-6" data-line-number="6"><span class="co"> *    Description:  Ejemplo para mover un motor PAP Unipolar por puerto paralelo</span></a>
<a class="sourceLine" id="cb3-7" data-line-number="7"><span class="co"> *</span></a>
<a class="sourceLine" id="cb3-8" data-line-number="8"><span class="co"> *        Version:  1.0</span></a>
<a class="sourceLine" id="cb3-9" data-line-number="9"><span class="co"> *        Created:  09/29/12 16:39:05</span></a>
<a class="sourceLine" id="cb3-10" data-line-number="10"><span class="co"> *       Revision:  none</span></a>
<a class="sourceLine" id="cb3-11" data-line-number="11"><span class="co"> *       Compiler:  gcc</span></a>
<a class="sourceLine" id="cb3-12" data-line-number="12"><span class="co"> *       License:   GPLv3</span></a>
<a class="sourceLine" id="cb3-13" data-line-number="13"><span class="co"> *</span></a>
<a class="sourceLine" id="cb3-14" data-line-number="14"><span class="co"> *         Author:  Daniel Campoverde CarriÃn</span></a>
<a class="sourceLine" id="cb3-15" data-line-number="15"><span class="co"> *   Organization:  Silly Bytes</span></a>
<a class="sourceLine" id="cb3-16" data-line-number="16"><span class="co"> *</span></a>
<a class="sourceLine" id="cb3-17" data-line-number="17"><span class="co"> * =====================================================================================</span></a>
<a class="sourceLine" id="cb3-18" data-line-number="18"><span class="co"> */</span></a>
<a class="sourceLine" id="cb3-19" data-line-number="19"></a>
<a class="sourceLine" id="cb3-20" data-line-number="20"><span class="pp">#include </span><span class="im">&lt;iostream&gt;</span></a>
<a class="sourceLine" id="cb3-21" data-line-number="21"><span class="pp">#include </span><span class="im">&quot;unipolar.cpp&quot;</span></a>
<a class="sourceLine" id="cb3-22" data-line-number="22"></a>
<a class="sourceLine" id="cb3-23" data-line-number="23">using namespace std;</a>
<a class="sourceLine" id="cb3-24" data-line-number="24"></a>
<a class="sourceLine" id="cb3-25" data-line-number="25"><span class="dt">int</span> main(<span class="dt">int</span> argc, <span class="dt">char</span> *argv[]){</a>
<a class="sourceLine" id="cb3-26" data-line-number="26"></a>
<a class="sourceLine" id="cb3-27" data-line-number="27">    <span class="dt">bool</span> angulo=false;</a>
<a class="sourceLine" id="cb3-28" data-line-number="28">    <span class="dt">bool</span> pasos=false;</a>
<a class="sourceLine" id="cb3-29" data-line-number="29">    motor_unipolar motor(<span class="dv">200</span>);</a>
<a class="sourceLine" id="cb3-30" data-line-number="30">    <span class="dt">int</span> direccion;</a>
<a class="sourceLine" id="cb3-31" data-line-number="31">    <span class="dt">int</span> valor;</a>
<a class="sourceLine" id="cb3-32" data-line-number="32"></a>
<a class="sourceLine" id="cb3-33" data-line-number="33">    <span class="cf">if</span>(argc &lt; <span class="dv">4</span>){ cout &lt;&lt; <span class="st">&quot;args&quot;</span>; <span class="cf">return</span> <span class="dv">1</span>;}</a>
<a class="sourceLine" id="cb3-34" data-line-number="34"></a>
<a class="sourceLine" id="cb3-35" data-line-number="35">    <span class="cf">for</span>(<span class="dt">int</span> i = <span class="dv">0</span>; i&lt;argc; i++){</a>
<a class="sourceLine" id="cb3-36" data-line-number="36"></a>
<a class="sourceLine" id="cb3-37" data-line-number="37">    <span class="cf">if</span>(argv[i]==<span class="st">&quot;-a&quot;</span>){ angulo=true; valor = <span class="dt">int</span>(argv[i+<span class="dv">1</span>]); }</a>
<a class="sourceLine" id="cb3-38" data-line-number="38">    <span class="cf">if</span>(argv[i]==<span class="st">&quot;-p&quot;</span>){ pasos=true; valor = <span class="dt">int</span>(argv[i+<span class="dv">1</span>]); }</a>
<a class="sourceLine" id="cb3-39" data-line-number="39">    <span class="cf">if</span>(argv[i]==<span class="st">&quot;-d&quot;</span>){</a>
<a class="sourceLine" id="cb3-40" data-line-number="40">        <span class="cf">if</span>(argv[i+<span class="dv">1</span>]==<span class="st">&quot;IZQ&quot;</span>) direccion = <span class="dv">1</span>;</a>
<a class="sourceLine" id="cb3-41" data-line-number="41">        <span class="cf">if</span>(argv[i+<span class="dv">1</span>]==<span class="st">&quot;DER&quot;</span>) direccion = <span class="dv">0</span>;</a>
<a class="sourceLine" id="cb3-42" data-line-number="42">    }</a>
<a class="sourceLine" id="cb3-43" data-line-number="43"></a>
<a class="sourceLine" id="cb3-44" data-line-number="44">    }</a>
<a class="sourceLine" id="cb3-45" data-line-number="45"></a>
<a class="sourceLine" id="cb3-46" data-line-number="46"></a>
<a class="sourceLine" id="cb3-47" data-line-number="47"><span class="cf">if</span>(pasos){</a>
<a class="sourceLine" id="cb3-48" data-line-number="48"></a>
<a class="sourceLine" id="cb3-49" data-line-number="49">    motor.step(valor,direccion);</a>
<a class="sourceLine" id="cb3-50" data-line-number="50"></a>
<a class="sourceLine" id="cb3-51" data-line-number="51">}<span class="cf">else</span> <span class="cf">if</span>(angulo){</a>
<a class="sourceLine" id="cb3-52" data-line-number="52"></a>
<a class="sourceLine" id="cb3-53" data-line-number="53">    motor.rotate(valor,direccion);</a>
<a class="sourceLine" id="cb3-54" data-line-number="54">}</a>
<a class="sourceLine" id="cb3-55" data-line-number="55">}</a></code></pre></div>
<p>Una vez compilado con <code>g++ unipolar.cpp -o rotate</code>, lo ejecutamos obteniendo este resultado:</p>
<div class="video embed-responsive embed-responsive-16by9">
<iframe src="https://www.youtube.com/embed/3VUYgr4zwLU" frameborder="0" allowfullscreen>
</iframe>
</div>
        </div>
    </div>
</div>


                    <div class="row">
                        <div class="col-sm-4">
                            
                        </div>

                        <div class="col-sm-4">
                            <a class="archive" href="../../archive.html">Archive</a>
                        </div>

                        <div class="col-sm-4">
                            
                        </div>
                    </div>
                </div>

            </div>
        </div>


        <footer class="container-fluid">
            <div class="row">
                <div id="sidebar" class="visible-xs visible-sm col-xs-12">
                    <div id="author">
    <img id="author-pic" src="../../img/daniel.jpg">
    <h3 id="author-name">Daniel Campoverde [alx741]</h3>
    <img id="location-icon" src="../../img/location_icon.png">
    <span id="location">Cuenca, Ecuador</span>
</div>

<div id="findme">
    <h2 class="sidebar-h2">FIND ME</h2>
    <a target="_blank" href="https://github.com/alx741">
        <img class="icon" src="../../img/github.png">
    </a>
    <a target="_blank" href="https://twitter.com/alx741alx">
        <img class="icon" src="../../img/twitter.png">
    </a>
    <a target="_blank" href="https://www.facebook.com/sillybytes/">
        <img class="icon" src="../../img/facebook.png">
    </a>
    <a target="_blank" href="https://plus.google.com/116038619580828681039">
        <img class="icon" src="../../img/google.png">
    </a>
    <a target="_blank" href="https://www.joindiaspora.com/u/alx741">
        <img class="icon" src="../../img/diaspora.png">
    </a>

    <div id="findme-textual">
        <b>Freenode:</b> #vim, #archlinux, #avr, #rust, #haskell,
        #yesod, #zsh, #sillybytes
        <hr>
        <b>Mailto:</b> alx@sillybytes.net
        <br>
        <b>GPG Key ID:</b> <a href="http://pgp.mit.edu/pks/lookup?op=get&search=0xEB0E776276450F22">76450F22</a>
        <hr>
        <b>Subscribe:</b> <a href="http://www.sillybytes.net/atom.xml">
            <img id="rss-img" alt="rss" src="../../img/rss.png" /> </a>
    </div>


    <div id="facebook-embed">
        <iframe src="//www.facebook.com/plugins/likebox.php?href=https%3A%2F%2Fwww.facebook.com%2Fsillybytes&amp;width&amp;height=290&amp;colorscheme=light&amp;show_faces=true&amp;header=true&amp;stream=false&amp;show_border=true" scrolling="yes" style="border:none; overflow:hidden;" allowtransparency="false" frameborder="0"></iframe>
    </div>
</div>

<div id="random">
    <h2 class="sidebar-h2">YOU MIGHT LIKE</h2>

    <div id="random-posts">
        <ul>
        </ul>
    </div>
</div>

<div id="about">
    <h2 class="sidebar-h2">ABOUT</h2>

    <a target="_blank" href="http://www.haskellers.com/user/4249">
        <img id="haskellers-img" class="badge" alt="I'm a Haskeller" src="../../img/haskellers.png">
    </a>

    <img id="fsf-img" class="badge" alt="Free Software Fundation Member" src="../../img/fsf.png">

    <a target="_blank" href="http://internetdefenseleague.org/">
        <img id="idl-img" class="badge" alt="Internet Defesen League" src="../../img/idl.png">
    </a>
</div>

<div id="dotfiles">
    <h2 class="sidebar-h2">DOTFILES</h2>
    <p>
        Software configuration, scripts, tools and magic.
        Be sure to add <b>attribution </b> when using them
        (fully or partially).
    </p>
    <a target="_blank" href="https://github.com/alx741/dotfiles#readme">
        <img id="dotfiles-img" src="../../img/dotfiles.png">
    </a>
</div>


<div id="license">
    <h2 class="sidebar-h2">LICENSE</h2>

    <a target="_blank" href="http://creativecommons.org/licenses/by-sa/3.0/deed.en_US">
        <img id="cc-img" alt="Creative Commons - SA - BY" src="../../img/cc.png">
    </a>
    <p id="cc-text">
        Silly Bytes by Daniel Alejandro Campoverde Carrión
        [alx741] is licensed under a
        <a href="http://creativecommons.org/licenses/by-sa/3.0/deed.en_US">
            Creative Commons Attribution-ShareAlike 3.0 Unported License.
        </a>
    </p>
</div>

                </div>
            </div>
        </footer>

        <script type="text/javascript" src="../../js/random_posts.js"></script>

    </body>
</html>
